---
import type { Product } from "@synoem/payload/payload-types";
import { Image } from "@unpic/astro";
import { getImageUrl } from "~/utils/get-image";
import {
  ProductBreadcrumb,
  RequestQuoteDesktop,
  RequestQuoteMobile,
  DownloadDatasheetButton,
  SocialShareButtons,
} from "~/components/react";
import DeviceWrapper from "./DeviceWrapper.astro";
import ProductFeatures from "./ProductFeatures.astro";
import { getLocaleFromUrl } from "~/i18n/utils";

interface Props {
  product: Product;
}

const { product } = Astro.props;

const { title, coverImage, excerpt, features } = product;

const locale = getLocaleFromUrl(Astro.url);
---

<section
  class="relative min-h-[600px] overflow-hidden text-white rounded-xl mb-4"
>
  <Image
    height={600}
    src={getImageUrl(coverImage)}
    alt="Product cover image"
    class="w-full h-full object-cover absolute inset-0"
  />
  <div
    class="absolute inset-0 bg-gradient-to-r from-black/70 to-black/30 md:to-transparent"
  >
  </div>
  <div
    class="container min-h-[600px] mx-auto p-4 md:p-8 h-full flex flex-col justify-center items-start relative z-10"
  >
    <div class="mb-2 md:mb-4 font-semibold text-primary-foreground">
      <ProductBreadcrumb product={product} locale={locale} client:load />
    </div>
    <h1 class="text-xl md:text-4xl font-bold mb-2 md:mb-4">
      {title}
    </h1>
    <p
      class="text-sm md:text-lg mb-4 md:mb-6 whitespace-normal max-w-full md:max-w-[600px]"
    >
      {excerpt}
    </p>
    <div class="w-full md:w-auto my-auto">
      <ProductFeatures features={features} />
    </div>
    <div class="flex justify-around items-center gap-2 w-full mt-4 md:mt-0">
      <div class="flex flex-col md:flex-row gap-2">
        <DeviceWrapper>
          <RequestQuoteDesktop
            slot="desktop"
            client:load
            product={product}
            locale={locale}
            size="lg"
          />
          <RequestQuoteMobile
            slot="mobile"
            client:load
            product={product}
            locale={locale}
            className="w-full min-w-[300px]"
            size="sm"
          />
        </DeviceWrapper>
        <DeviceWrapper>
          <DownloadDatasheetButton
            product={product}
            variant="secondary"
            client:load
            slot="desktop"
            size="lg"
            locale={locale}
          />
          <DownloadDatasheetButton
            product={product}
            variant="secondary"
            client:load
            className="w-full"
            slot="mobile"
            size="sm"
            locale={locale}
          />
        </DeviceWrapper>
      </div>

     <div class="flex-1/3 hidden md:block">
      <SocialShareButtons
      url={Astro.url.toString()}
      client:load
      slot="desktop"
      className="justify-end gap-4"
    />
    </div>
  </div>
</section>
